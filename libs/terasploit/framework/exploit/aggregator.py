#######
# Exploit: Aggregator
#######

from libs.terasploit.framework.opts.opt_distributor import Opt
from urllib.parse import urlparse


class ShellContainer(object):
    """ Contains shell from exploit targets """
    
    def __init__(self, shell):
        self.shell = shell
        
    def __get__(self,instance,owner):
        return self.shell
    
class InsertShell(ShellContainer):
    """ Inserts shell into shell container class """
    
    def __set__(self,instance,value):
        self.shell = value
        

class exploit:
    """ Descriptor classes handler """
    
    shell = InsertShell('')
    

class Shell:

    def new(url) -> None:
        setattr(exploit,'shell',url)
        
    def get() -> str:
        return exploit.shell
    

class ExploitAggregator(object):
    """ Gather contents for session """
    
    def __init__(self, shell_type: str) -> None:
        self.shell = shell_type
        self.lhost = Opt('payload').GetOPT('lhost')
        self.lport = Opt('payload').GetOPT('lport')
        
    def return_contents(self):
        if self.shell in ['reverse_tcp','reverse_udp']:
            return self.lhost, self.lport
        
        if self.shell == 'backdoor_cmd':
            return urlparse(Shell.get()).hostname, Shell.get() 
